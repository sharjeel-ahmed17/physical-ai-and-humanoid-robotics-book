from fastapi import FastAPI
from src.routers.embeddings_router import router as embeddings_router
from src.routers.query_router import router as query_router
from contextlib import asynccontextmanager
from src.lib.configs import settings
from src.lib.openaiagentsdk_config import AgentConfig
from src.lib.vectordb_connection import ConnectDb

@asynccontextmanager
async def lifespan(app: FastAPI):
    print("started!")
    config_agent = AgentConfig(
        base_url=settings.openrouter_api,
        api_key=settings.api_key,
        model_name=settings.model_name
    )
    app.state.agent_config = config_agent
    yield
    print("closed!")

app = FastAPI(lifespan=lifespan)
app.include_router(router, prefix="/api")

if __name__ == '__main__':
    import uvicorn
    uvicorn.run("main:app", host="0.0.0.0", port=8000, reload=True)